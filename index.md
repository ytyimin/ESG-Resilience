---


---

<h1 id="analysis-of-esg-and-resilienceasset-4">Analysis of ESG and Resilience(Asset 4)</h1>
<h2 id="data-processing">Data Processing</h2>
<h3 id="step-1.-merging-and-computing-variables">Step 1. Merging and Computing Variables</h3>
<p>We first obtained merged data from ESG and compustat based on NA and GB data sources. The initial data has 45,223 observations from NA and 56,718 observations from GB dataset. The combined source from NA and GB has a total of 101,941 observations.</p>
<p>There are duplicates in the NA and GB datasets (i.e., records with the same ISIN and fyear appears in both NA and GB dataset). We removed all the duplicates by prioritizing observations from the NA dataset (as it has more complete information). The results in a reduced observation of 95,225 records.</p>
<p>We computed the following relevant variables. To maintain validity of all the computations, we first remove invalid negative values.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># remove invalid negative numbers</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>at <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>ceq <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>csho <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>prcc_f <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>icapt <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>seq <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>lct <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>dltt <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>revt <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>invt <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
</code></pre>
<p>This resulted in a total number of 93,211 observations. Next we remove observations with missing ISIN or gvkeys.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># remove obervations with missing ISIN values</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span><span class="token operator">!</span>is.na<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>ISIN<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
</code></pre>
<p>After this, we have 66,803 observations. Now we compute the derived values.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># compute variables</span>
<span class="token comment"># ROA: net income divided by total asset</span>
dat_f<span class="token operator">$</span>ROAib <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ib <span class="token operator">/</span> dat_f<span class="token operator">$</span>at
dat_f<span class="token operator">$</span>ROAni <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ni <span class="token operator">/</span> dat_f<span class="token operator">$</span>at
<span class="token comment"># ROE: net income divided by share holder equity</span>
dat_f<span class="token operator">$</span>ROEib <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ib <span class="token operator">/</span> dat_f<span class="token operator">$</span>ceq
dat_f<span class="token operator">$</span>ROEni <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ni <span class="token operator">/</span> dat_f<span class="token operator">$</span>ceq
<span class="token comment"># ROE: net income divided by stock equity</span>
dat_f<span class="token operator">$</span>ROEmib <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ib <span class="token operator">/</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>csho <span class="token operator">*</span> dat_f<span class="token operator">$</span>prcc_f<span class="token punctuation">)</span>
dat_f<span class="token operator">$</span>ROEmni <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ni <span class="token operator">/</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>csho <span class="token operator">*</span> dat_f<span class="token operator">$</span>prcc_f<span class="token punctuation">)</span>
<span class="token comment"># ROI: net income divided by total investment</span>
dat_f<span class="token operator">$</span>ROIib <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ib <span class="token operator">/</span> dat_f<span class="token operator">$</span>icapt
dat_f<span class="token operator">$</span>ROIni <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ni <span class="token operator">/</span> dat_f<span class="token operator">$</span>icapt
<span class="token comment"># TQ: tobin's Q</span>
dat_f<span class="token operator">$</span>TQ <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>at <span class="token operator">+</span> dat_f<span class="token operator">$</span>csho <span class="token operator">*</span> dat_f<span class="token operator">$</span>prcc_f <span class="token operator">-</span> dat_f<span class="token operator">$</span>ceq<span class="token punctuation">)</span> <span class="token operator">/</span> dat_f<span class="token operator">$</span>at
<span class="token comment"># LR: Leverage: </span>
dat_f<span class="token operator">$</span>LR <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>dltt <span class="token operator">+</span> dat_f<span class="token operator">$</span>dlc<span class="token punctuation">)</span> <span class="token operator">/</span> dat_f<span class="token operator">$</span>seq
<span class="token comment"># CR: Current Ratio: current assets / current liabilities</span>
dat_f<span class="token operator">$</span>CR <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>act <span class="token operator">/</span> dat_f<span class="token operator">$</span>lct
<span class="token comment"># QR: Quick Ratio: (cash + receivables + inventory) / long term debt</span>
dat_f<span class="token operator">$</span>QR <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>ch <span class="token operator">+</span> dat_f<span class="token operator">$</span>rect <span class="token operator">+</span> dat_f<span class="token operator">$</span>invt<span class="token punctuation">)</span> <span class="token operator">/</span> dat_f<span class="token operator">$</span>dltt
<span class="token comment"># REAT: retained earnings over total asset ratio</span>
dat_f<span class="token operator">$</span>REAT <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>re <span class="token operator">/</span> dat_f<span class="token operator">$</span>at
<span class="token comment"># XSGASALE: xsga over sales ratio</span>
dat_f<span class="token operator">$</span>XSGASALE <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>xsga <span class="token operator">/</span> dat_f<span class="token operator">$</span>revt
<span class="token comment"># MKTSHR: Market share by total revenue in each ggroup</span>
library<span class="token punctuation">(</span><span class="token string">"plyr"</span><span class="token punctuation">)</span>
dat_f <span class="token operator">=</span> ddply<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> .<span class="token punctuation">(</span>fyear<span class="token punctuation">,</span>ggroup<span class="token punctuation">)</span><span class="token punctuation">,</span> transform<span class="token punctuation">,</span> MKTSHR <span class="token operator">=</span> revt<span class="token operator">/</span>sum<span class="token punctuation">(</span>revt<span class="token punctuation">,</span>na.rm<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token comment"># next lag inventory, working capital, and revenue to compute some additional variables</span>
library<span class="token punctuation">(</span><span class="token string">"dplyr"</span><span class="token punctuation">)</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>order<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>ISIN<span class="token punctuation">,</span> dat_f<span class="token operator">$</span>fyear<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f <span class="token percent-operator operator">%&gt;%</span>                           
  group_by<span class="token punctuation">(</span>gvkey<span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  dplyr<span class="token operator">::</span>mutate<span class="token punctuation">(</span>invtL1 <span class="token operator">=</span> lag<span class="token punctuation">(</span>invt<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> default <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  dplyr<span class="token operator">::</span>mutate<span class="token punctuation">(</span>wcapL1 <span class="token operator">=</span> lag<span class="token punctuation">(</span>wcap<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> default <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>  
  dplyr<span class="token operator">::</span>mutate<span class="token punctuation">(</span>revtL1 <span class="token operator">=</span> lag<span class="token punctuation">(</span>revt<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> default <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># INV: average inventory</span>
dat_f<span class="token operator">$</span>INV <span class="token operator">&lt;-</span> rowMeans<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'invt'</span><span class="token punctuation">,</span> <span class="token string">'invtL1'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
<span class="token comment"># INVTURN: inventory turn</span>
dat_f<span class="token operator">$</span>INVTURN <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>cogs <span class="token operator">/</span> dat_f<span class="token operator">$</span>INV
<span class="token comment"># WCAP: average working capitals</span>
dat_f<span class="token operator">$</span>WCAP <span class="token operator">&lt;-</span> rowMeans<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'wcap'</span><span class="token punctuation">,</span> <span class="token string">'wcapL1'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
<span class="token comment"># REVGRW: revenue growth</span>
dat_f<span class="token operator">$</span>REVGRW <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>revt <span class="token operator">-</span> dat_f<span class="token operator">$</span>revtL1<span class="token punctuation">)</span> <span class="token operator">/</span> dat_f<span class="token operator">$</span>revtL1 
<span class="token comment"># ELI : empirical leanness index</span>
library<span class="token punctuation">(</span>fixest<span class="token punctuation">)</span>
m.eli <span class="token operator">&lt;-</span> feols<span class="token punctuation">(</span>log<span class="token punctuation">(</span>invt<span class="token punctuation">)</span> <span class="token operator">~</span> log<span class="token punctuation">(</span>sale<span class="token punctuation">)</span> <span class="token operator">|</span> gsector <span class="token operator">+</span> fyear<span class="token punctuation">,</span> data <span class="token operator">=</span> dat_f<span class="token punctuation">)</span>
x <span class="token operator">&lt;-</span> <span class="token operator">-</span>scale<span class="token punctuation">(</span>resid<span class="token punctuation">(</span>m.eli<span class="token punctuation">)</span><span class="token punctuation">)</span>
dat_f<span class="token operator">$</span>ELI <span class="token operator">&lt;-</span> <span class="token keyword">NA</span>
x_obs <span class="token operator">&lt;-</span> unlist<span class="token punctuation">(</span>m.eli<span class="token operator">$</span>obs_selection<span class="token punctuation">,</span> use.names<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
dat_f<span class="token operator">$</span>ELI<span class="token punctuation">[</span>x_obs<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> x
</code></pre>
<p>Next we compute information about company’s missing ESG information. We classify companies into three different categories:</p>
<ul>
<li>[0] missESG = 0 : always have ESG information</li>
<li>[1] missESG = 1: once have ESG information, no interruption</li>
<li>[2] missESG = 2: have some ESG information, with interruptions</li>
<li>[3] missESG = 3: does not have any ESG information</li>
</ul>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># check ESG sample/mssing profile</span>
<span class="token comment"># first we create a dummy variable indicating whether ESG score is missing</span>
dat_f<span class="token operator">$</span>missESG<span class="token operator">&lt;-</span> <span class="token number">0</span>
<span class="token comment"># initialize the first value</span>
temp_isin <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"ISIN"</span><span class="token punctuation">]</span>
temp_start <span class="token operator">&lt;-</span> <span class="token number">1</span>
<span class="token comment"># only check ESG information for year 2013 and onwards</span>
temp_missESG_no <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
temp_missESG_all <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
temp_missESG_int <span class="token operator">&lt;-</span> <span class="token number">0</span> <span class="token comment"># no information, so assume no interruption (set value to 0) unless otherwise</span>
loop_ALL <span class="token operator">&lt;-</span> nrow<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>loop_ALL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment"># if same company</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_isin <span class="token operator">==</span> dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"ISIN"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    <span class="token comment"># if all previous records are missing  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_all <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> 
      temp_missESG_all <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment"># if partial previous records are missing  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_no <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> 
      temp_missESG_no <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># if no interruption so far  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_int <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> temp_missESG_all <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment"># if there are non-missing values now</span>
      temp_missESG_int <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment"># will move to next company</span>
    j <span class="token operator">&lt;-</span> i<span class="token operator">-</span><span class="token number">1</span>
    <span class="token comment"># first check whether the current company has all missing values of ESG</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_all <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dat_f<span class="token punctuation">[</span>temp_start<span class="token operator">:</span>j<span class="token punctuation">,</span><span class="token string">"missESG"</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">3</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span>  <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_no <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dat_f<span class="token punctuation">[</span>temp_start<span class="token operator">:</span>j<span class="token punctuation">,</span><span class="token string">"missESG"</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">0</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_int <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
          dat_f<span class="token punctuation">[</span>temp_start<span class="token operator">:</span>j<span class="token punctuation">,</span><span class="token string">"missESG"</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">2</span>
        <span class="token keyword">else</span>
          dat_f<span class="token punctuation">[</span>temp_start<span class="token operator">:</span>j<span class="token punctuation">,</span><span class="token string">"missESG"</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>   <span class="token comment"># next check whether the current company has some missing values</span>
    <span class="token comment"># reset value holders</span>
    temp_isin <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"ISIN"</span><span class="token punctuation">]</span>
    temp_start <span class="token operator">&lt;-</span> i
    temp_missESG_all <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    temp_missESG_no <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    temp_missESG_int <span class="token operator">&lt;-</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>   
</code></pre>
<p>It turns out that with Asset 4 data source, most of the companies have consistent ESG information with very few firms missing ESG information.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token operator">&gt;</span> table<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>missESG<span class="token punctuation">)</span>
  <span class="token number">0</span>     <span class="token number">1</span>     <span class="token number">2</span>     <span class="token number">3</span> 
<span class="token number">64984</span>  <span class="token number">1343</span>   <span class="token number">380</span>    <span class="token number">96</span>
</code></pre>
<p>As such, the missESG variable is unlikely to help in our subsequent analysis. Next we add upstreamness information, as well as the supply chain network information.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># merge upstreamness data</span>
library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ISIN"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"isin"</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_UP<span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"isin"</span><span class="token punctuation">,</span><span class="token string">"fyear"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># merge supply chain information - obtain downstream buyer information</span>
dat_SC_source <span class="token operator">&lt;-</span> dat_SC<span class="token punctuation">[</span>order<span class="token punctuation">(</span>dat_SC<span class="token operator">$</span>source_isin<span class="token punctuation">,</span> dat_SC<span class="token operator">$</span>fyear<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_SC_source <span class="token operator">&lt;-</span> dat_SC_source <span class="token percent-operator operator">%&gt;%</span> distinct<span class="token punctuation">(</span>source_isin<span class="token punctuation">,</span> fyear<span class="token punctuation">,</span> .keep_all <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_SC_source <span class="token percent-operator operator">%&gt;%</span> select<span class="token punctuation">(</span>source_isin<span class="token punctuation">,</span> fyear<span class="token punctuation">,</span> num_buyers_source<span class="token punctuation">,</span> avg_emp_buyers_source<span class="token punctuation">,</span> std_dev_emp_buyers_source<span class="token punctuation">,</span> avg_assets_buyers_source<span class="token punctuation">,</span> std_dev_assets_buyers_source<span class="token punctuation">,</span> num_loc_buyers_source<span class="token punctuation">)</span><span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"isin"</span> <span class="token operator">=</span> <span class="token string">"source_isin"</span><span class="token punctuation">,</span><span class="token string">"fyear"</span> <span class="token operator">=</span> <span class="token string">"fyear"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"num_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_n"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"avg_emp_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_emp_mu"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"std_dev_emp_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_emp_sd"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"avg_assets_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_ass_mu"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"std_dev_assets_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_ass_sd"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"num_loc_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_loc_n"</span>

<span class="token comment"># merge supply chain information - obtain upstream supplier information</span>
dat_SC_target <span class="token operator">&lt;-</span> dat_SC<span class="token punctuation">[</span>order<span class="token punctuation">(</span>dat_SC<span class="token operator">$</span>target_isin<span class="token punctuation">,</span> dat_SC<span class="token operator">$</span>fyear<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_SC_target <span class="token operator">&lt;-</span> dat_SC_target <span class="token percent-operator operator">%&gt;%</span> distinct<span class="token punctuation">(</span>target_isin<span class="token punctuation">,</span> fyear<span class="token punctuation">,</span> .keep_all <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_SC_target <span class="token percent-operator operator">%&gt;%</span> select<span class="token punctuation">(</span>target_isin<span class="token punctuation">,</span> fyear<span class="token punctuation">,</span> num_suppliers_target<span class="token punctuation">,</span> avg_emp_suppliers_target<span class="token punctuation">,</span> std_dev_emp_suppliers_target<span class="token punctuation">,</span> avg_assets_supplier_target<span class="token punctuation">,</span> std_dev_assets_supplier_target<span class="token punctuation">,</span> num_loc_suppliers_target<span class="token punctuation">)</span><span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"isin"</span> <span class="token operator">=</span> <span class="token string">"target_isin"</span><span class="token punctuation">,</span><span class="token string">"fyear"</span> <span class="token operator">=</span> <span class="token string">"fyear"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"num_suppliers_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_n"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"avg_emp_suppliers_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_emp_mu"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"std_dev_emp_suppliers_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_emp_sd"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"avg_assets_supplier_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_ass_mu"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"std_dev_assets_supplier_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_ass_sd"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"num_loc_suppliers_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_loc_n"</span>
</code></pre>
<p>There are quite some missing values for the upstreamness and supply chain information. Next we bring in the instrument variables by industry sector and year.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># compute average ESG by year and sector</span>
dat_f.avg <span class="token operator">&lt;-</span> aggregate<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>VALUESCORE1<span class="token punctuation">,</span> list<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>fyear<span class="token punctuation">,</span> dat_f<span class="token operator">$</span>gsector<span class="token punctuation">)</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span>mean<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.1"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"fyear"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.2"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"gsector"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"x"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"ESG1.AVG"</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_f.avg<span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"fyear"</span><span class="token punctuation">,</span><span class="token string">"gsector"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># compute average WCAP by year and sector</span>
dat_f.avg <span class="token operator">&lt;-</span> aggregate<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>WCAP<span class="token punctuation">,</span> list<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>fyear<span class="token punctuation">,</span> dat_f<span class="token operator">$</span>gsector<span class="token punctuation">)</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span>mean<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.1"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"fyear"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.2"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"gsector"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"x"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"WCAP.AVG"</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_f.avg<span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"fyear"</span><span class="token punctuation">,</span><span class="token string">"gsector"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># compute average INV by year and sector</span>
dat_f.avg <span class="token operator">&lt;-</span> aggregate<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>INV<span class="token punctuation">,</span> list<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>fyear<span class="token punctuation">,</span> dat_f<span class="token operator">$</span>gsector<span class="token punctuation">)</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span>mean<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.1"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"fyear"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.2"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"gsector"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"x"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"INV.AVG"</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_f.avg<span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"fyear"</span><span class="token punctuation">,</span><span class="token string">"gsector"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Finally, we remove observations with inf values.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># remove infinite values</span>
dat_f <span class="token operator">&lt;-</span> dat_f <span class="token percent-operator operator">%&gt;%</span> 
  filter_if<span class="token punctuation">(</span><span class="token operator">~</span>is.numeric<span class="token punctuation">(</span>.<span class="token punctuation">)</span><span class="token punctuation">,</span> all_vars<span class="token punctuation">(</span><span class="token operator">!</span>is.infinite<span class="token punctuation">(</span>.<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>This resulted in 54,222 observations. An overall description of the dataset can be found at <a href="https://github.com/ytyimin/ESG-Resilience/blob/main/des_f.csv">summary statistics</a>.</p>
<h2 id="causal-analysis">Causal Analysis</h2>
<p>Industry average ESG performance is driven by factors that common to an industry sector but are exogenous to specific firms’ financial performance; but firms’ ESG strategy adoption level will follow the industry average. To check this assumption, we first examine the effect of industry average ESG on individual firm’s ESG adoption.</p>
<h2 id="effect-of-instrument-variable-on-independent-variable">Effect of instrument variable on independent variable</h2>
<p>We first ran a regression with ESG.AVG on ESG. The result shows that the instrument is effective.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token operator">&gt;</span> m0 <span class="token operator">&lt;-</span> feols<span class="token punctuation">(</span>E1 <span class="token operator">~</span>   E1.AVG <span class="token operator">+</span> at <span class="token operator">+</span> emp <span class="token operator">+</span> caps  <span class="token operator">+</span> opeps <span class="token operator">+</span> ppent <span class="token operator">+</span> MKTSHR<span class="token operator">+</span>	LR <span class="token operator">+</span>REAT <span class="token operator">+</span>  REVGRW <span class="token operator">+</span> XSGASALE  <span class="token operator">+</span> upstreamness <span class="token operator">+</span> sply_n <span class="token operator">+</span> sply_loc_n <span class="token operator">+</span>  sply_emp_mu <span class="token operator">+</span>  sply_emp_sd <span class="token operator">+</span>  sply_ass_mu <span class="token operator">+</span>  sply_ass_sd <span class="token operator">|</span> loc <span class="token operator">+</span> gsector <span class="token punctuation">,</span>  dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>fyear <span class="token operator">&gt;=</span> <span class="token number">2016</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> panel.id <span class="token operator">=</span> <span class="token operator">~</span> gvkey <span class="token operator">+</span> fyear<span class="token punctuation">)</span> NOTE<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span><span class="token number">650</span> observations removed because of <span class="token keyword">NA</span> values <span class="token punctuation">(</span>LHS<span class="token operator">:</span> <span class="token number">119</span><span class="token punctuation">,</span> RHS<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span><span class="token number">634</span><span class="token punctuation">,</span> Fixed<span class="token operator">-</span>effects<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">)</span>. <span class="token operator">&gt;</span> summary<span class="token punctuation">(</span>m0<span class="token punctuation">,</span> diagnostics <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span> OLS estimation<span class="token punctuation">,</span> Dep. Var.<span class="token operator">:</span> E1
Observations<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">345</span> 
Fixed<span class="token operator">-</span>effects<span class="token operator">:</span> loc<span class="token operator">:</span> <span class="token number">51</span><span class="token punctuation">,</span>  gsector<span class="token operator">:</span> <span class="token number">11</span>
Standard<span class="token operator">-</span>errors<span class="token operator">:</span> Clustered <span class="token punctuation">(</span>gvkey<span class="token punctuation">)</span> 
                  Estimate   Std. Error   t value   Pr<span class="token punctuation">(</span><span class="token operator">&gt;</span><span class="token operator">|</span>t<span class="token operator">|</span><span class="token punctuation">)</span>    
E1.AVG        <span class="token number">1.293498e+00</span> <span class="token number">8.257875e-02</span> <span class="token number">15.663814</span>  <span class="token operator">&lt;</span> <span class="token number">2.2e-16</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
at           <span class="token operator">-</span><span class="token number">5.780000e-10</span> <span class="token number">4.630000e-10</span> <span class="token operator">-</span><span class="token number">1.247410</span> <span class="token number">2.1243e-01</span>    
emp           <span class="token number">1.179504e-04</span> <span class="token number">8.525332e-05</span>  <span class="token number">1.383529</span> <span class="token number">1.6670e-01</span>    
caps          <span class="token number">2.322000e-09</span> <span class="token number">5.117000e-09</span>  <span class="token number">0.453784</span> <span class="token number">6.5005e-01</span>    
opeps        <span class="token operator">-</span><span class="token number">1.945915e-06</span> <span class="token number">1.429385e-05</span> <span class="token operator">-</span><span class="token number">0.136137</span> <span class="token number">8.9173e-01</span>    
ppent         <span class="token number">1.321000e-09</span> <span class="token number">4.130000e-10</span>  <span class="token number">3.200192</span> <span class="token number">1.4008e-03</span> <span class="token operator">*</span><span class="token operator">*</span> 
MKTSHR        <span class="token number">6.557847e-03</span> <span class="token number">2.695152e-03</span>  <span class="token number">2.433201</span> <span class="token number">1.5077e-02</span> <span class="token operator">*</span>  
LR            <span class="token number">1.114088e-04</span> <span class="token number">9.565543e-05</span>  <span class="token number">1.164689</span> <span class="token number">2.4432e-01</span>    
REAT          <span class="token number">7.212654e-03</span> <span class="token number">3.236510e-03</span>  <span class="token number">2.228528</span> <span class="token number">2.5986e-02</span> <span class="token operator">*</span>  
REVGRW       <span class="token operator">-</span><span class="token number">8.752450e-04</span> <span class="token number">1.993516e-04</span> <span class="token operator">-</span><span class="token number">4.390460</span> <span class="token number">1.2067e-05</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
XSGASALE      <span class="token number">2.587122e-05</span> <span class="token number">6.535263e-05</span>  <span class="token number">0.395871</span> <span class="token number">6.9225e-01</span>    
upstreamness <span class="token operator">-</span><span class="token number">2.595001e-03</span> <span class="token number">5.313367e-03</span> <span class="token operator">-</span><span class="token number">0.488391</span> <span class="token number">6.2534e-01</span>    
sply_n       <span class="token operator">-</span><span class="token number">4.938680e-04</span> <span class="token number">3.803927e-04</span> <span class="token operator">-</span><span class="token number">1.298311</span> <span class="token number">1.9437e-01</span>    
sply_loc_n    <span class="token number">1.561030e-02</span> <span class="token number">1.596641e-03</span>  <span class="token number">9.776962</span>  <span class="token operator">&lt;</span> <span class="token number">2.2e-16</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
sply_emp_mu  <span class="token operator">-</span><span class="token number">2.618753e-04</span> <span class="token number">2.114480e-04</span> <span class="token operator">-</span><span class="token number">1.238486</span> <span class="token number">2.1572e-01</span>    
sply_emp_sd   <span class="token number">2.774140e-04</span> <span class="token number">1.366548e-04</span>  <span class="token number">2.030035</span> <span class="token number">4.2521e-02</span> <span class="token operator">*</span>  
sply_ass_mu  <span class="token operator">-</span><span class="token number">7.830000e-10</span> <span class="token number">1.061000e-09</span> <span class="token operator">-</span><span class="token number">0.737808</span> <span class="token number">4.6074e-01</span>    
sply_ass_sd   <span class="token number">3.520000e-10</span> <span class="token number">4.460000e-10</span>  <span class="token number">0.791051</span> <span class="token number">4.2903e-01</span>    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Signif. codes<span class="token operator">:</span>  <span class="token number">0</span> <span class="token string">'***'</span> <span class="token number">0.001</span> <span class="token string">'**'</span> <span class="token number">0.01</span> <span class="token string">'*'</span> <span class="token number">0.05</span> <span class="token string">'.'</span> <span class="token number">0.1</span> <span class="token string">' '</span> <span class="token number">1</span>
RMSE<span class="token operator">:</span> <span class="token number">0.144334</span>     Adj. R2<span class="token operator">:</span> <span class="token number">0.399526</span>
                 Within R2<span class="token operator">:</span> <span class="token number">0.250103</span>
</code></pre>
<p>The <a href="https://github.com/ytyimin/ESG-Resilience/blob/main/plot_resid.png">residual plot</a> shows that the regression is valid. Next, we conduct the BP test to check for heteroskedasticity.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token operator">&gt;</span> <span class="token comment"># bp test </span>
<span class="token operator">&gt;</span> <span class="token comment"># check this for BP test https://prepnuggets.com/glossary/breusch-pagan-test/ </span>
<span class="token operator">&gt;</span> <span class="token comment">#Fit a linear regression model to the data and obtain the residuals. </span>
<span class="token operator">&gt;</span> <span class="token comment">#Square the residuals and save them as a new variable. </span>
<span class="token operator">&gt;</span> <span class="token comment">#Regress the squared residuals on the predictor variables from the original model. </span>
<span class="token operator">&gt;</span> <span class="token comment">#Test the significance of the coefficients in the squared residual regression model. </span>
<span class="token operator">&gt;</span> <span class="token comment">#If the p-values of the coefficients are below a certain threshold (usually 0.05), it suggests that heteroskedasticity is present in the original model. </span>
<span class="token operator">&gt;</span> x <span class="token operator">&lt;-</span> resid<span class="token punctuation">(</span>m0<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span> 
<span class="token operator">&gt;</span> dat_f<span class="token operator">$</span>res2 <span class="token operator">&lt;-</span> <span class="token keyword">NA</span> 
<span class="token operator">&gt;</span> x_obs <span class="token operator">&lt;-</span> unlist<span class="token punctuation">(</span>m0<span class="token operator">$</span>obs_selection<span class="token punctuation">,</span> use.names<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>  <span class="token comment"># observations removed in regression </span>
<span class="token operator">&gt;</span> dat_f<span class="token operator">$</span>res2<span class="token punctuation">[</span>x_obs<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> x 
Warning message<span class="token operator">:</span>
In dat_f<span class="token operator">$</span>res2<span class="token punctuation">[</span>x_obs<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> x <span class="token operator">:</span>
  number of items to replace is not a multiple of replacement length 
<span class="token operator">&gt;</span> mt <span class="token operator">&lt;-</span> feols<span class="token punctuation">(</span>res2 <span class="token operator">~</span>   E1.AVG <span class="token operator">+</span> at <span class="token operator">+</span> emp <span class="token operator">+</span> caps <span class="token operator">+</span> opeps <span class="token operator">+</span> ppent <span class="token operator">+</span> MKTSHR<span class="token operator">+</span>	LR <span class="token operator">+</span>REAT  <span class="token operator">+</span> REVGRW <span class="token operator">+</span> XSGASALE <span class="token operator">+</span> upstreamness <span class="token operator">+</span> sply_n <span class="token operator">+</span> sply_loc_n <span class="token operator">+</span>  sply_emp_mu <span class="token operator">+</span>  sply_emp_sd <span class="token operator">+</span>  sply_ass_mu <span class="token operator">+</span>  sply_ass_sd <span class="token operator">|</span>  loc <span class="token operator">+</span> gsector <span class="token punctuation">,</span>  dat_f<span class="token punctuation">[</span>dat_f<span class="token operator">$</span>fyear <span class="token operator">&gt;=</span> <span class="token number">2016</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> panel.id <span class="token operator">=</span> <span class="token operator">~</span> gvkey <span class="token operator">+</span> fyear<span class="token punctuation">)</span> 
NOTE<span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span><span class="token number">867</span> observations removed because of <span class="token keyword">NA</span> values <span class="token punctuation">(</span>LHS<span class="token operator">:</span> <span class="token number">15</span><span class="token punctuation">,</span><span class="token number">706</span><span class="token punctuation">,</span> RHS<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span><span class="token number">634</span><span class="token punctuation">,</span> Fixed<span class="token operator">-</span>effects<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">)</span>. 
<span class="token operator">&gt;</span> summary<span class="token punctuation">(</span>mt<span class="token punctuation">,</span> diagnostics <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span> 
OLS estimation<span class="token punctuation">,</span> Dep. Var.<span class="token operator">:</span> res2
Observations<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">128</span> 
Fixed<span class="token operator">-</span>effects<span class="token operator">:</span> loc<span class="token operator">:</span> <span class="token number">43</span><span class="token punctuation">,</span>  gsector<span class="token operator">:</span> <span class="token number">11</span>
Standard<span class="token operator">-</span>errors<span class="token operator">:</span> Clustered <span class="token punctuation">(</span>gvkey<span class="token punctuation">)</span> 
                  Estimate   Std. Error   t value   Pr<span class="token punctuation">(</span><span class="token operator">&gt;</span><span class="token operator">|</span>t<span class="token operator">|</span><span class="token punctuation">)</span>    
E1.AVG       <span class="token operator">-</span><span class="token number">1.526876e-03</span> <span class="token number">2.613461e-02</span> <span class="token operator">-</span><span class="token number">0.058424</span> <span class="token number">0.95342421</span>    
at            <span class="token number">2.996600e-10</span> <span class="token number">1.158200e-09</span>  <span class="token number">0.258733</span> <span class="token number">0.79590029</span>    
emp           <span class="token number">3.671267e-06</span> <span class="token number">6.401200e-06</span>  <span class="token number">0.573528</span> <span class="token number">0.56643026</span>    
caps         <span class="token operator">-</span><span class="token number">1.097473e-08</span> <span class="token number">1.833000e-08</span> <span class="token operator">-</span><span class="token number">0.598731</span> <span class="token number">0.54950291</span>    
opeps         <span class="token number">3.722709e-06</span> <span class="token number">1.156527e-05</span>  <span class="token number">0.321887</span> <span class="token number">0.74761302</span>    
ppent        <span class="token operator">-</span><span class="token number">1.678550e-09</span> <span class="token number">2.474200e-09</span> <span class="token operator">-</span><span class="token number">0.678434</span> <span class="token number">0.49767061</span>    
MKTSHR        <span class="token number">1.201973e-07</span> <span class="token number">2.325673e-04</span>  <span class="token number">0.000517</span> <span class="token number">0.99958775</span>    
LR           <span class="token operator">-</span><span class="token number">3.894557e-05</span> <span class="token number">1.262610e-05</span> <span class="token operator">-</span><span class="token number">3.084530</span> <span class="token number">0.00210087</span> <span class="token operator">*</span><span class="token operator">*</span> 
REAT         <span class="token operator">-</span><span class="token number">1.787194e-04</span> <span class="token number">1.550058e-04</span> <span class="token operator">-</span><span class="token number">1.152985</span> <span class="token number">0.24922185</span>    
REVGRW       <span class="token operator">-</span><span class="token number">7.283976e-05</span> <span class="token number">1.886411e-05</span> <span class="token operator">-</span><span class="token number">3.861288</span> <span class="token number">0.00012084</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
XSGASALE     <span class="token operator">-</span><span class="token number">1.074730e-04</span> <span class="token number">4.915766e-05</span> <span class="token operator">-</span><span class="token number">2.186291</span> <span class="token number">0.02905067</span> <span class="token operator">*</span>  
upstreamness <span class="token operator">-</span><span class="token number">5.313245e-04</span> <span class="token number">1.230788e-03</span> <span class="token operator">-</span><span class="token number">0.431695</span> <span class="token number">0.66606657</span>    
sply_n        <span class="token number">8.819490e-06</span> <span class="token number">5.526954e-05</span>  <span class="token number">0.159572</span> <span class="token number">0.87325368</span>    
sply_loc_n   <span class="token operator">-</span><span class="token number">7.580100e-05</span> <span class="token number">2.835190e-04</span> <span class="token operator">-</span><span class="token number">0.267358</span> <span class="token number">0.78925488</span>    
sply_emp_mu   <span class="token number">5.489646e-05</span> <span class="token number">6.322220e-05</span>  <span class="token number">0.868310</span> <span class="token number">0.38545566</span>    
sply_emp_sd  <span class="token operator">-</span><span class="token number">3.525957e-05</span> <span class="token number">3.476888e-05</span> <span class="token operator">-</span><span class="token number">1.014113</span> <span class="token number">0.31080082</span>    
sply_ass_mu   <span class="token number">5.775000e-11</span> <span class="token number">1.954000e-10</span>  <span class="token number">0.295566</span> <span class="token number">0.76762941</span>    
sply_ass_sd  <span class="token operator">-</span><span class="token number">9.390000e-12</span> <span class="token number">9.880000e-11</span> <span class="token operator">-</span><span class="token number">0.094993</span> <span class="token number">0.92434114</span>    
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
Signif. codes<span class="token operator">:</span>  <span class="token number">0</span> <span class="token string">'***'</span> <span class="token number">0.001</span> <span class="token string">'**'</span> <span class="token number">0.01</span> <span class="token string">'*'</span> <span class="token number">0.05</span> <span class="token string">'.'</span> <span class="token number">0.1</span> <span class="token string">' '</span> <span class="token number">1</span>
RMSE<span class="token operator">:</span> <span class="token number">0.029081</span>     Adj. R2<span class="token operator">:</span> <span class="token number">0.019928</span>
                 Within R2<span class="token operator">:</span> <span class="token number">0.004526</span>
</code></pre>
<p>The above result shows that the regression does not exhibit heteroskedasticity .</p>

