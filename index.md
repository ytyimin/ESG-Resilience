---


---

<h1 id="analysis-of-esg-and-resilienceasset-4">Analysis of ESG and Resilience(Asset 4)</h1>
<h2 id="data-processing">Data Processing</h2>
<h3 id="step-1.-merging-and-computing-variables">Step 1. Merging and Computing Variables</h3>
<p>We first obtained merged data from ESG and compustat based on NA and GB data sources. The initial data has 45,223 observations from NA and 56,718 observations from GB dataset. The combined source from NA and GB has a total of 101,941 observations.</p>
<p>There are duplicates in the NA and GB datasets (i.e., records with the same ISIN and fyear appears in both NA and GB dataset). We removed all the duplicates by prioritizing observations from the NA dataset (as it has more complete information). The results in a reduced observation of 95,225 records.</p>
<p>We computed the following relevant variables.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># compute variables</span>
<span class="token comment"># ROA: net income divided by total asset</span>
dat_f<span class="token operator">$</span>ROAib <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ib <span class="token operator">/</span> dat_f<span class="token operator">$</span>at
dat_f<span class="token operator">$</span>ROAni <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ni <span class="token operator">/</span> dat_f<span class="token operator">$</span>at
<span class="token comment"># ROE: net income divided by share holder equity</span>
dat_f<span class="token operator">$</span>ROEib <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ib <span class="token operator">/</span> dat_f<span class="token operator">$</span>ceq
dat_f<span class="token operator">$</span>ROEni <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ni <span class="token operator">/</span> dat_f<span class="token operator">$</span>ceq
<span class="token comment"># ROE: net income divided by stock equity</span>
dat_f<span class="token operator">$</span>ROEmib <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ib <span class="token operator">/</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>csho <span class="token operator">*</span> dat_f<span class="token operator">$</span>prcc_f<span class="token punctuation">)</span>
dat_f<span class="token operator">$</span>ROEmni <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ni <span class="token operator">/</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>csho <span class="token operator">*</span> dat_f<span class="token operator">$</span>prcc_f<span class="token punctuation">)</span>
<span class="token comment"># ROI: net income divided by total investment</span>
dat_f<span class="token operator">$</span>ROIib <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ib <span class="token operator">/</span> dat_f<span class="token operator">$</span>icapt
dat_f<span class="token operator">$</span>ROIni <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>ni <span class="token operator">/</span> dat_f<span class="token operator">$</span>icapt
<span class="token comment"># TQ: tobin's Q</span>
dat_f<span class="token operator">$</span>TQ <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>at <span class="token operator">+</span> dat_f<span class="token operator">$</span>csho <span class="token operator">*</span> dat_f<span class="token operator">$</span>prcc_f <span class="token operator">-</span> dat_f<span class="token operator">$</span>ceq<span class="token punctuation">)</span> <span class="token operator">/</span> dat_f<span class="token operator">$</span>at
<span class="token comment"># LR: Leverage: </span>
dat_f<span class="token operator">$</span>LR <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>dltt <span class="token operator">+</span> dat_f<span class="token operator">$</span>dlc<span class="token punctuation">)</span> <span class="token operator">/</span> dat_f<span class="token operator">$</span>seq
<span class="token comment"># CR: Current Ratio: current assets / current liabilities</span>
dat_f<span class="token operator">$</span>CR <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>act <span class="token operator">/</span> dat_f<span class="token operator">$</span>lct
<span class="token comment"># QR: Quick Ratio: (cash + receivables + inventory) / long term debt</span>
dat_f<span class="token operator">$</span>QR <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>ch <span class="token operator">+</span> dat_f<span class="token operator">$</span>rect <span class="token operator">+</span> dat_f<span class="token operator">$</span>invt<span class="token punctuation">)</span> <span class="token operator">/</span> dat_f<span class="token operator">$</span>dltt
<span class="token comment"># REAT: retained earnings over total asset ratio</span>
dat_f<span class="token operator">$</span>REAT <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>re <span class="token operator">/</span> dat_f<span class="token operator">$</span>at
<span class="token comment"># XSGASALE: xsga over sales ratio</span>
dat_f<span class="token operator">$</span>XSGASALE <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>xsga <span class="token operator">/</span> dat_f<span class="token operator">$</span>revt
<span class="token comment"># MKTSHR: Market share by total revenue in each ggroup</span>
library<span class="token punctuation">(</span><span class="token string">"plyr"</span><span class="token punctuation">)</span>
dat_f <span class="token operator">=</span> ddply<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> .<span class="token punctuation">(</span>fyear<span class="token punctuation">,</span>ggroup<span class="token punctuation">)</span><span class="token punctuation">,</span> transform<span class="token punctuation">,</span> MKTSHR <span class="token operator">=</span> revt<span class="token operator">/</span>sum<span class="token punctuation">(</span>revt<span class="token punctuation">,</span>na.rm<span class="token operator">=</span><span class="token boolean">TRUE</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token comment"># next lag inventory, working capital, and revenue to compute some additional variables</span>
library<span class="token punctuation">(</span><span class="token string">"dplyr"</span><span class="token punctuation">)</span>
dat_f <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>order<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>ISIN<span class="token punctuation">,</span> dat_f<span class="token operator">$</span>fyear<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_f <span class="token operator">&lt;-</span> dat_f <span class="token percent-operator operator">%&gt;%</span>                           
  group_by<span class="token punctuation">(</span>gvkey<span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  dplyr<span class="token operator">::</span>mutate<span class="token punctuation">(</span>invtL1 <span class="token operator">=</span> lag<span class="token punctuation">(</span>invt<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> default <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  dplyr<span class="token operator">::</span>mutate<span class="token punctuation">(</span>wcapL1 <span class="token operator">=</span> lag<span class="token punctuation">(</span>wcap<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> default <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>  
  dplyr<span class="token operator">::</span>mutate<span class="token punctuation">(</span>revtL1 <span class="token operator">=</span> lag<span class="token punctuation">(</span>revt<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> default <span class="token operator">=</span> <span class="token keyword">NA</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># INV: average inventory</span>
dat_f<span class="token operator">$</span>INV <span class="token operator">&lt;-</span> rowMeans<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'invt'</span><span class="token punctuation">,</span> <span class="token string">'invtL1'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
<span class="token comment"># INVTURN: inventory turn</span>
dat_f<span class="token operator">$</span>INVTURN <span class="token operator">&lt;-</span> dat_f<span class="token operator">$</span>cogs <span class="token operator">/</span> dat_f<span class="token operator">$</span>INV
<span class="token comment"># WCAP: average working capitals</span>
dat_f<span class="token operator">$</span>WCAP <span class="token operator">&lt;-</span> rowMeans<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'wcap'</span><span class="token punctuation">,</span> <span class="token string">'wcapL1'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
<span class="token comment"># REVGRW: revenue growth</span>
dat_f<span class="token operator">$</span>REVGRW <span class="token operator">&lt;-</span> <span class="token punctuation">(</span>dat_f<span class="token operator">$</span>revt <span class="token operator">-</span> dat_f<span class="token operator">$</span>revtL1<span class="token punctuation">)</span> <span class="token operator">/</span> dat_f<span class="token operator">$</span>revtL1 
<span class="token comment"># ELI : empirical leanness index</span>
library<span class="token punctuation">(</span>fixest<span class="token punctuation">)</span>
m.eli <span class="token operator">&lt;-</span> feols<span class="token punctuation">(</span>log<span class="token punctuation">(</span>invt<span class="token punctuation">)</span> <span class="token operator">~</span> log<span class="token punctuation">(</span>sale<span class="token punctuation">)</span> <span class="token operator">|</span> gsector <span class="token operator">+</span> fyear<span class="token punctuation">,</span> data <span class="token operator">=</span> dat_f<span class="token punctuation">)</span>
x <span class="token operator">&lt;-</span> <span class="token operator">-</span>scale<span class="token punctuation">(</span>resid<span class="token punctuation">(</span>m.eli<span class="token punctuation">)</span><span class="token punctuation">)</span>
dat_f<span class="token operator">$</span>ELI <span class="token operator">&lt;-</span> <span class="token keyword">NA</span>
x_obs <span class="token operator">&lt;-</span> unlist<span class="token punctuation">(</span>m.eli<span class="token operator">$</span>obs_selection<span class="token punctuation">,</span> use.names<span class="token operator">=</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span>
dat_f<span class="token operator">$</span>ELI<span class="token punctuation">[</span>x_obs<span class="token punctuation">]</span> <span class="token operator">&lt;-</span> x
</code></pre>
<p>Next we compute information about company’s missing ESG information. We classify companies into three different categories:</p>
<ul>
<li>[0] missESG = 0 : always have ESG information</li>
<li>[1] missESG = 1: once have ESG information, no interruption</li>
<li>[2] missESG = 2: have some ESG information, with interruptions</li>
<li>[3] missESG = 3: does not have any ESG information</li>
</ul>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># check ESG sample/mssing profile</span>
<span class="token comment"># first we create a dummy variable indicating whether ESG score is missing</span>
dat_f<span class="token operator">$</span>missESG<span class="token operator">&lt;-</span> <span class="token number">0</span>
<span class="token comment"># initialize the first value</span>
temp_isin <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"ISIN"</span><span class="token punctuation">]</span>
temp_start <span class="token operator">&lt;-</span> <span class="token number">1</span>
<span class="token comment"># only check ESG information for year 2013 and onwards</span>
temp_missESG_no <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
temp_missESG_all <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
temp_missESG_int <span class="token operator">&lt;-</span> <span class="token number">0</span> <span class="token comment"># no information, so assume no interruption (set value to 0) unless otherwise</span>
loop_ALL <span class="token operator">&lt;-</span> nrow<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>loop_ALL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment"># if same company</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_isin <span class="token operator">==</span> dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"ISIN"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    <span class="token comment"># if all previous records are missing  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_all <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> 
      temp_missESG_all <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment"># if partial previous records are missing  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_no <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> 
      temp_missESG_no <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># if no interruption so far  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_int <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> temp_missESG_all <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment"># if there are non-missing values now</span>
      temp_missESG_int <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment"># will move to next company</span>
    j <span class="token operator">&lt;-</span> i<span class="token operator">-</span><span class="token number">1</span>
    <span class="token comment"># first check whether the current company has all missing values of ESG</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_all <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dat_f<span class="token punctuation">[</span>temp_start<span class="token operator">:</span>j<span class="token punctuation">,</span><span class="token string">"missESG"</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">3</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span>  <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_no <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dat_f<span class="token punctuation">[</span>temp_start<span class="token operator">:</span>j<span class="token punctuation">,</span><span class="token string">"missESG"</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">0</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>temp_missESG_int <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
          dat_f<span class="token punctuation">[</span>temp_start<span class="token operator">:</span>j<span class="token punctuation">,</span><span class="token string">"missESG"</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">2</span>
        <span class="token keyword">else</span>
          dat_f<span class="token punctuation">[</span>temp_start<span class="token operator">:</span>j<span class="token punctuation">,</span><span class="token string">"missESG"</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>   <span class="token comment"># next check whether the current company has some missing values</span>
    <span class="token comment"># reset value holders</span>
    temp_isin <span class="token operator">&lt;-</span> dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"ISIN"</span><span class="token punctuation">]</span>
    temp_start <span class="token operator">&lt;-</span> i
    temp_missESG_all <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    temp_missESG_no <span class="token operator">&lt;-</span> ifelse<span class="token punctuation">(</span>is.na<span class="token punctuation">(</span>dat_f<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token string">"VALUESCORE1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    temp_missESG_int <span class="token operator">&lt;-</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>   
</code></pre>
<p>It turns out that with Asset 4 data source, most of the companies have consistent ESG information with very few firms missing ESG information.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token operator">&gt;</span> table<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>missESG<span class="token punctuation">)</span>
  <span class="token number">0</span>     <span class="token number">1</span>     <span class="token number">2</span>     <span class="token number">3</span> 
<span class="token number">91699</span>  <span class="token number">2100</span>  <span class="token number">1218</span>   <span class="token number">208</span>
</code></pre>
<p>As such, we do not use the missESG variable in our subsequent analysis.</p>
<p>Next we add upstreamness information, as well as the supply chain network information.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># merge upstreamness data</span>
library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"ISIN"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"isin"</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_UP<span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"isin"</span><span class="token punctuation">,</span><span class="token string">"fyear"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># merge supply chain information - obtain downstream buyer information</span>
dat_SC_source <span class="token operator">&lt;-</span> dat_SC<span class="token punctuation">[</span>order<span class="token punctuation">(</span>dat_SC<span class="token operator">$</span>source_isin<span class="token punctuation">,</span> dat_SC<span class="token operator">$</span>fyear<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_SC_source <span class="token operator">&lt;-</span> dat_SC_source <span class="token percent-operator operator">%&gt;%</span> distinct<span class="token punctuation">(</span>source_isin<span class="token punctuation">,</span> fyear<span class="token punctuation">,</span> .keep_all <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_SC_source <span class="token percent-operator operator">%&gt;%</span> select<span class="token punctuation">(</span>source_isin<span class="token punctuation">,</span> fyear<span class="token punctuation">,</span> num_buyers_source<span class="token punctuation">,</span> avg_emp_buyers_source<span class="token punctuation">,</span> std_dev_emp_buyers_source<span class="token punctuation">,</span> avg_assets_buyers_source<span class="token punctuation">,</span> std_dev_assets_buyers_source<span class="token punctuation">,</span> num_loc_buyers_source<span class="token punctuation">)</span><span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"isin"</span> <span class="token operator">=</span> <span class="token string">"source_isin"</span><span class="token punctuation">,</span><span class="token string">"fyear"</span> <span class="token operator">=</span> <span class="token string">"fyear"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"num_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_n"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"avg_emp_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_emp_mu"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"std_dev_emp_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_emp_sd"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"avg_assets_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_ass_mu"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"std_dev_assets_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_ass_sd"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"num_loc_buyers_source"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"byrs_loc_n"</span>

<span class="token comment"># merge supply chain information - obtain upstream supplier information</span>
dat_SC_target <span class="token operator">&lt;-</span> dat_SC<span class="token punctuation">[</span>order<span class="token punctuation">(</span>dat_SC<span class="token operator">$</span>target_isin<span class="token punctuation">,</span> dat_SC<span class="token operator">$</span>fyear<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
dat_SC_target <span class="token operator">&lt;-</span> dat_SC_target <span class="token percent-operator operator">%&gt;%</span> distinct<span class="token punctuation">(</span>target_isin<span class="token punctuation">,</span> fyear<span class="token punctuation">,</span> .keep_all <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_SC_target <span class="token percent-operator operator">%&gt;%</span> select<span class="token punctuation">(</span>target_isin<span class="token punctuation">,</span> fyear<span class="token punctuation">,</span> num_suppliers_target<span class="token punctuation">,</span> avg_emp_suppliers_target<span class="token punctuation">,</span> std_dev_emp_suppliers_target<span class="token punctuation">,</span> avg_assets_supplier_target<span class="token punctuation">,</span> std_dev_assets_supplier_target<span class="token punctuation">,</span> num_loc_suppliers_target<span class="token punctuation">)</span><span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"isin"</span> <span class="token operator">=</span> <span class="token string">"target_isin"</span><span class="token punctuation">,</span><span class="token string">"fyear"</span> <span class="token operator">=</span> <span class="token string">"fyear"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"num_suppliers_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_n"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"avg_emp_suppliers_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_emp_mu"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"std_dev_emp_suppliers_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_emp_sd"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"avg_assets_supplier_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_ass_mu"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"std_dev_assets_supplier_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_ass_sd"</span>
colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"num_loc_suppliers_target"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"sply_loc_n"</span>
</code></pre>
<p>It appears that we have too many missing values for the upstreamness and supply chain information. Next we bring in the instrument variables by industry sector and year.</p>
<pre class=" language-r"><code class="prism  language-r"><span class="token comment"># compute average ESG by year and sector</span>
dat_f.avg <span class="token operator">&lt;-</span> aggregate<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>VALUESCORE1<span class="token punctuation">,</span> list<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>fyear<span class="token punctuation">,</span> dat_f<span class="token operator">$</span>gsector<span class="token punctuation">)</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span>mean<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.1"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"fyear"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.2"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"gsector"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"x"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"ESG1.AVG"</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_f.avg<span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"fyear"</span><span class="token punctuation">,</span><span class="token string">"gsector"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># compute average WCAP by year and sector</span>
dat_f.avg <span class="token operator">&lt;-</span> aggregate<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>WCAP<span class="token punctuation">,</span> list<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>fyear<span class="token punctuation">,</span> dat_f<span class="token operator">$</span>gsector<span class="token punctuation">)</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span>mean<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.1"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"fyear"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.2"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"gsector"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"x"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"WCAP.AVG"</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_f.avg<span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"fyear"</span><span class="token punctuation">,</span><span class="token string">"gsector"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># compute average INV by year and sector</span>
dat_f.avg <span class="token operator">&lt;-</span> aggregate<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>INV<span class="token punctuation">,</span> list<span class="token punctuation">(</span>dat_f<span class="token operator">$</span>fyear<span class="token punctuation">,</span> dat_f<span class="token operator">$</span>gsector<span class="token punctuation">)</span><span class="token punctuation">,</span> FUN<span class="token operator">=</span>mean<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.1"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"fyear"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"Group.2"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"gsector"</span>
colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span><span class="token punctuation">[</span>colnames<span class="token punctuation">(</span>dat_f.avg<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"x"</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token string">"INV.AVG"</span>
dat_f <span class="token operator">&lt;-</span> left_join<span class="token punctuation">(</span>dat_f<span class="token punctuation">,</span> dat_f.avg<span class="token punctuation">,</span> by <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"fyear"</span><span class="token punctuation">,</span><span class="token string">"gsector"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>We will bring in individual ESG score instrument variable later as we explain where the effects come from. A overall description of the dataset can be found at <a href="https://github.com/ytyimin/ESG-Resilience/blob/main/des_f.csv">summary statistics</a>.</p>
<h2 id="causal-analysis">Causal Analysis</h2>
<p>Industry average ESG performance is exogenous to specific firms’ ROA performance; but firms’ ESG strategy adoption level will follow the industry average. To check this assumption, we first examine the effect of industry average ESG on individual firm’s ESG adoption.</p>
<h2 id="effect-of-instrument-variable-on-independent-variable">Effect of instrument variable on independent variable</h2>
<p>We first ran a regression with ESG.AVG on ESG. The result shows that the instrument is effective.</p>

